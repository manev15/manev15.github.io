
<!DOCTYPE html>
<html lang="en">
<head>
    <base href="/" />
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<title>Genie</title>
<link href="https://fonts.googleapis.com/css?family=Material+Icons" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Archivo:ital,wght@0,400;0,500;0,600;0,700;1,400&amp;display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <style>
        .link{
            color:#595959;
        }

        .link:hover{
            color:#595959;
            text-decoration: underline;
        }
    </style>
    <script>
    var userAgent = navigator.userAgent.toLowerCase();
    //if (userAgent.indexOf("android") > -1) {
     // window.location.href = "https://play.google.com/store/apps/details?id=com.echo.lactalis";
   // }
	
	
	function addToCalendar(){
	

	//const table = document.getElementById('appointment-table');
   // const row = table.insertRow();
  //  row.insertCell().textContent = getParameterValue('title') || '';
  //  row.insertCell().textContent = getParameterValue('start') || '';
  //  row.insertCell().textContent = getParameterValue('end') || '';
   // row.insertCell().textContent = getParameterValue('note') || '';
       document.getElementById('title').textContent =  getParameterValue('type') || '';
    document.getElementById('startTime').textContent =  convertToCustomDateFormatVisible(getParameterValue('start_time')) || '';
    document.getElementById('endTime').textContent =  convertToCustomDateFormatVisible(getParameterValue('end_time')) || '';
	
           var icsContent = "BEGIN:VCALENDAR\n" +
                "VERSION:2.0\n" +
                "BEGIN:VEVENT\n" +
                "SUMMARY:"+getParameterValue('type')+"\n" +
                "DTSTART:"+converToLocalTime(getParameterValue('start_time'))+"\n" +
                "DTEND:"+converToLocalTime(getParameterValue('end_time'))+"\n" +
                "END:VEVENT\n" +
                "END:VCALENDAR\n";

            var encodedContent = encodeURIComponent(icsContent);
            var url = 'data:text/calendar;charset=utf-8,' + encodedContent;
            window.location.href = url;
	}
	
	function getParameterValue(parameterName) {
  const urlSearchParams = new URLSearchParams(window.location.search);
  return urlSearchParams.get(parameterName);
}

function convertToCustomDateFormat(timestamp) {
  const date = new Date(timestamp);
  
  const year = date.getUTCFullYear();
  const month = String(date.getUTCMonth() + 1).padStart(2, '0');
  const day = String(date.getUTCDate()).padStart(2, '0');
  
  const hours = String(date.getUTCHours()).padStart(2, '0');
  const minutes = String(date.getUTCMinutes()).padStart(2, '0');
  const seconds = String(date.getUTCSeconds()).padStart(2, '0');
  
  return `${year}${month}${day}T${hours}${minutes}${seconds}Z`;
}

function convertToCustomDateFormatVisible(timestamp) {
  const date = new Date(timestamp);
  
  return date.toLocaleDateString("en-US");
 
}



function converToLocalTime(serverDate) {

    var dt = new Date(serverDate*1000);
    var localDate = dt;
    
    var gmt = localDate;
        var min = gmt.getTime() / 1000 / 60; // convert gmt date to minutes
        var localNow = new Date().getTimezoneOffset(); // get the timezone
        // offset in minutes
        var localTime = min - localNow; // get the local time

    var dateStr = new Date(localTime * 1000 * 60);
    // dateStr = dateStr.toISOString("yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"); // this will return as just the server date format i.e., yyyy-MM-dd'T'HH:mm:ss.SSS'Z'
    dateStr = dateStr.toString("YYYYMMDDTHHMMSSZ");
    return dateStr;
}
  </script>
    </head>

<style>
    .link{
        color:#595959;
    }

    .link:hover{
        color:#595959;
        text-decoration: underline;
    }
	 .appointment-card {
      display: flex;
      flex-direction: column;
      border: 1px solid #ddd;
      padding: 20px;
      margin-bottom: 20px;
    }

    .appointment-card h2 {
      margin: 0;
    }

    .appointment-card p {
      margin: 10px 0;
    }
</style>

<body style="background:#ebebeb" onload="addToCalendar()">
    <div class="container-fluid">
  	
    <div class="row justify-content-center">
        <div class="col-md-8 text-center pt-5">
            <img src="/images/genie_logo.png" width="250px" alt="genie_logo" />
        </div>
    </div>
	
	<div class="row justify-content-center">
 <div class="appointment-card">
    <h2>Детали за терминот:</h2>
    <p><strong>Услуга:</strong> <span id="title"></span></p>
    <p><strong>Почеток:</strong> <span id="startTime"></span></p>
    <p><strong>Крај:</strong> <span id="endTime"></span></p>
    <p><strong>Забелешка:</strong> /<span id="description"></span></p>
  </div>
		
		</div>
	
    <div class="row justify-content-center">
        <a class="link" href="privacy-policy.html">Privacy Policy</a>
    </div>

    </div>
</body>

</html>
